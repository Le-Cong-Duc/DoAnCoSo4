<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·∫∑t V√© - Galaxy Cinema</title>
    <link rel="stylesheet" href="./bookticket.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="booking-container">

        <div class="header-gradient">
            <h1>ƒê·∫∑t V√© Xem Phim</h1>
            <p class="mb-0">D&T Cinema</p>
        </div>

        <!-- Movie Info -->
        <div class="movie-info-section">
            <div class="row align-items-center">
                <div class="col-md-3 text-center mb-3 mb-md-0">
                    <img class="movie-poster"
                         th:src="${movie.posterUrl}"
                         th:alt="${movie.movieName}">
                </div>

                <div class="col-md-9">
                    <h2 class="mb-3" th:text="${movie.movieName}"></h2>

                    <div class="mb-2">
                        <span class="me-3"> <span th:text="${movie.duration} + ' ph√∫t'"></span></span>
                        <span class="me-3"> <span th:text="${movie.releaseDate}"></span></span>
                        <span class="age-badge" th:text="${movie.ageLimit} + '+'"></span>
                        <span class="ms-3"><strong th:text="${movie.rating}">‚ú®</strong></span>
                    </div>


                    <p class="mb-1">
                        <strong>Th·ªÉ lo·∫°i:</strong>

                        <span th:if="${movie.genre == 1}">Ho·∫°t h√¨nh</span>
                        <span th:if="${movie.genre == 2}">H√†nh ƒë·ªông</span>

                    </p>
                    <p class="mb-1"><strong>ƒê·∫°o di·ªÖn:</strong> <span th:text="${movie.director}"></span></p>
                    <p class="mb-0"><strong>Di·ªÖn vi√™n:</strong> <span th:text="${movie.casts}"></span></p>
                </div>
            </div>
        </div>

        <!-- Booking Form -->
        <div class="p-4" id="bookingForm">
            <form th:action="@{/booking/confirm}" method="post">
                <input type="hidden" name="movieId" th:value="${movie.movieId}">

                <!-- Step 1: Ch·ªçn Ng√†y -->
                <h3 class="section-title">üìÖ Ch·ªçn Ng√†y Chi·∫øu</h3>
                <div class="row g-3 mb-4">
                    <div class="col-6 col-md-4 col-lg-2" th:each="date, stat : ${dates}">
                        <input type="radio"
                               class="btn-check"
                               name="selectedDate"
                               th:id="'date' + ${stat.index}"
                               th:value="${date.dateValue}"
                               th:checked="${stat.index == 0}"
                               required>
                        <label class="date-card w-100" th:for="'date' + ${stat.index}">
                            <div class="small" th:text="${date.dayName}">H√¥m Nay</div>
                            <div class="fs-5 fw-bold" th:text="${date.dateNumber}">08/11</div>
                        </label>
                    </div>
                </div>

                <!-- Step 2: Ch·ªçn R·∫°p -->
                <h3 class="section-title">üè¢ Ch·ªçn R·∫°p Chi·∫øu</h3>
                <div class="row g-3 mb-4">
                    <div class="col-md-6 col-lg-3" th:each="cinema, stat : ${cinemas}">
                        <input type="radio"
                               class="btn-check cinema-radio"
                               name="cinemaId"
                               th:id="'cinema' + ${cinema.id}"
                               th:value="${cinema.id}"
                               onchange="showSeatSection()"
                               required>
                        <label class="cinema-card w-100" th:for="'cinema' + ${cinema.id}">
                            <div class="card-body p-0">
                                <h6 class="fw-bold mb-2" th:text="${cinema.name}">Galaxy Nguy·ªÖn Du</h6>
                                <p class="small text-muted mb-0">
                                    üìç <span th:text="${cinema.address}">116 Nguy·ªÖn Du, Q1</span>
                                </p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Step 3: Ch·ªçn Su·∫•t Chi·∫øu (Show after cinema selected) -->
                <div class="seat-section">
                    <h3 class="section-title">üïê Ch·ªçn Su·∫•t Chi·∫øu</h3>
                    <div class="row g-3 mb-4">
                        <div class="col-6 col-md-4 col-lg-2" th:each="time, stat : ${showtimes}">
                            <input type="radio"
                                   class="btn-check"
                                   name="showtimeId"
                                   th:id="'time' + ${time.id}"
                                   th:value="${time.id}"
                                   required>
                            <label class="showtime-btn w-100 text-center" th:for="'time' + ${time.id}">
                                <div class="fs-5" th:text="${time.timeSlot}">14:45</div>
                            </label>
                        </div>
                    </div>

                    <!-- Step 4: Ch·ªçn Gh·∫ø -->
                    <h3 class="section-title">üí∫ Ch·ªçn Gh·∫ø Ng·ªìi</h3>

                    <div class="screen">M√ÄN H√åNH</div>

                    <div class="seat-map mb-4">
                        <div class="seat-row" th:each="row : ${seatRows}">
                            <span class="row-label" th:text="${row}">A</span>

                            <div th:each="col : ${seatCols}">
                                <input type="checkbox"
                                       class="seat-checkbox"
                                       name="seats"
                                       th:id="'seat-' + ${row} + ${col}"
                                       th:value="${row} + ${col}"
                                       th:data-price="${#lists.contains(vipRows, row)} ? '90000' : '70000'"
                                       onchange="updateSummary()"
                                       th:disabled="${#lists.contains(occupiedSeats, row + col)}">

                                <label th:for="'seat-' + ${row} + ${col}"
                                       class="seat-label"
                                       th:classappend="${#lists.contains(occupiedSeats, row + col)} ? 'occupied' : (${#lists.contains(vipRows, row)} ? 'vip' : '')"
                                       th:text="${row} + ${col}">
                                    A1
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Legend -->
                    <div class="d-flex justify-content-center gap-4 mb-4 flex-wrap">
                        <div class="d-flex align-items-center gap-2">
                            <span class="legend-box" style="background: #ecf0f1; border: 2px solid #ddd;"></span>
                            <span>Gh·∫ø Tr·ªëng</span>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="legend-box" style="background: #fff3cd; border: 2px solid #ffc107;"></span>
                            <span>Gh·∫ø VIP</span>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="legend-box"
                                  style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></span>
                            <span>ƒêang Ch·ªçn</span>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="legend-box" style="background: #e74c3c;"></span>
                            <span>ƒê√£ ƒê·∫∑t</span>
                        </div>
                    </div>

                    <!-- Booking Summary -->
                    <div class="booking-summary mb-4">
                        <div class="row mb-2">
                            <div class="col-6 text-muted">Phim:</div>
                            <div class="col-6 text-end fw-bold" th:text="${movie.movieName}">Tr√°i Tim Qu√™ Qu·∫∑t</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">R·∫°p:</div>
                            <div class="col-6 text-end fw-bold" id="selectedCinemaDisplay">---</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">Su·∫•t chi·∫øu:</div>
                            <div class="col-6 text-end fw-bold" id="selectedShowtimeDisplay">---</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">Gh·∫ø ƒë√£ ch·ªçn:</div>
                            <div class="col-6 text-end fw-bold" id="selectedSeatsDisplay">Ch∆∞a ch·ªçn</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-6 text-muted">T·ªïng ti·ªÅn:</div>
                            <div class="col-6 text-end">
                                <span class="summary-total" id="totalPriceDisplay">0 VNƒê</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="row g-3">
                        <div class="col-md-6">
                            <button type="button" class="btn btn-secondary btn-custom w-100" onclick="history.back()">
                                ‚Üê Quay L·∫°i
                            </button>
                        </div>
                        <div class="col-md-6">
                            <button type="submit" class="btn btn-continue btn-custom w-100" id="btnSubmit">
                                Ti·∫øp T·ª•c Thanh To√°n ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div th:replace="User/footer :: footer"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>